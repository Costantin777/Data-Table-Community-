<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3D Футбол</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        background: #87ceeb;
      }

      canvas {
        display: block;
      }

      /* Інтерфейс для відображення рахунку */
      .scoreboard {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        color: white;
        font-size: 24px;
        font-family: Arial, sans-serif;
        background: rgba(0, 0, 0, 0.5);
        padding: 10px 20px;
        border-radius: 10px;
      }
    </style>
  </head>
  <body>
    <div class="scoreboard" id="scoreboard">Гравець 1: 0 | Гравець 2: 0</div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cannon-es@0.18.0/dist/cannon-es.js"></script>
    <script>
      let scene,
        camera,
        renderer,
        ball,
        player1,
        player2,
        player3,
        score1 = 0,
        score2 = 0;
      let world, ballBody, playerBody1, playerBody2, playerBody3;
      let controls = { up: false, down: false, left: false, right: false };
      const scoreboard = document.getElementById("scoreboard");

      init();
      animate();

      function init() {
        // Сцена
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87ceeb);

        // Камера
        camera = new THREE.PerspectiveCamera(
          75,
          window.innerWidth / window.innerHeight,
          0.1,
          1000
        );
        camera.position.set(0, 10, 20);

        // Рендерер
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Світло
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(5, 10, 7.5);
        scene.add(light);

        // Поле
        const fieldGeometry = new THREE.PlaneGeometry(20, 40);
        const grassTexture = new THREE.TextureLoader().load(
          "https://i.imgur.com/c4gFMzO.jpg"
        );
        const fieldMaterial = new THREE.MeshBasicMaterial({
          map: grassTexture,
        });
        const field = new THREE.Mesh(fieldGeometry, fieldMaterial);
        field.rotation.x = -Math.PI / 2;
        scene.add(field);

        // Ворота
        const goalGeometry = new THREE.BoxGeometry(2, 1, 0.5);
        const goalMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff });
        const goal1 = new THREE.Mesh(goalGeometry, goalMaterial);
        goal1.position.set(0, 0.5, -19.5);
        scene.add(goal1);

        const goal2 = new THREE.Mesh(goalGeometry, goalMaterial);
        goal2.position.set(0, 0.5, 19.5);
        scene.add(goal2);

        // Фізика світу
        world = new CANNON.World();
        world.gravity.set(0, -9.82, 0);

        // Створення м'яча
        const ballShape = new CANNON.Sphere(0.5);
        ballBody = new CANNON.Body({ mass: 0.5 });
        ballBody.addShape(ballShape);
        ballBody.position.set(0, 0.5, 0);
        world.addBody(ballBody);

        const ballGeometry = new THREE.SphereGeometry(0.5, 32, 32);
        const ballMaterial = new THREE.MeshStandardMaterial({
          color: 0xffffff,
        });
        ball = new THREE.Mesh(ballGeometry, ballMaterial);
        scene.add(ball);

        // Створення гравців
        const playerShape = new CANNON.Box(new CANNON.Vec3(0.5, 1, 0.5));
        playerBody1 = new CANNON.Body({ mass: 1 });
        playerBody1.addShape(playerShape);
        playerBody1.position.set(-5, 1, 0);
        world.addBody(playerBody1);

        const player1Geometry = new THREE.BoxGeometry(1, 2, 1);
        const playerMaterial1 = new THREE.MeshStandardMaterial({
          color: 0xff0000,
        });
        player1 = new THREE.Mesh(player1Geometry, playerMaterial1);
        scene.add(player1);

        // Гравець 2
        playerBody2 = new CANNON.Body({ mass: 1 });
        playerBody2.addShape(playerShape);
        playerBody2.position.set(5, 1, 0);
        world.addBody(playerBody2);

        const playerMaterial2 = new THREE.MeshStandardMaterial({
          color: 0x0000ff,
        });
        player2 = new THREE.Mesh(player1Geometry, playerMaterial2);
        scene.add(player2);

        // Гравець 3
        playerBody3 = new CANNON.Body({ mass: 1 });
        playerBody3.addShape(playerShape);
        playerBody3.position.set(0, 1, -10);
        world.addBody(playerBody3);

        const playerMaterial3 = new THREE.MeshStandardMaterial({
          color: 0x00ff00,
        });
        player3 = new THREE.Mesh(player1Geometry, playerMaterial3);
        scene.add(player3);

        // Обробка клавіш для керування
        window.addEventListener("keydown", function (event) {
          switch (event.key) {
            case "w":
              controls.up = true;
              break;
            case "s":
              controls.down = true;
              break;
            case "a":
              controls.left = true;
              break;
            case "d":
              controls.right = true;
              break;
          }
        });

        window.addEventListener("keyup", function (event) {
          switch (event.key) {
            case "w":
              controls.up = false;
              break;
            case "s":
              controls.down = false;
              break;
            case "a":
              controls.left = false;
              break;
            case "d":
              controls.right = false;
              break;
          }
        });
      }

      function animate() {
        requestAnimationFrame(animate);
        updatePhysics();
        updateControls();
        renderer.render(scene, camera);
      }

      function updatePhysics() {
        world.step(1 / 60);
        ball.position.copy(ballBody.position);
        player1.position.copy(playerBody1.position);
        player2.position.copy(playerBody2.position);
        player3.position.copy(playerBody3.position);
      }

      function updateControls() {
        const speed = 0.1;
        if (controls.up) playerBody1.position.z -= speed;
        if (controls.down) playerBody1.position.z += speed;
        if (controls.left) playerBody1.position.x -= speed;
        if (controls.right) playerBody1.position.x += speed;

        // Виявлення голу
        if (
          ballBody.position.z < -19 &&
          ballBody.position.x > -1 &&
          ballBody.position.x < 1
        ) {
          score1++;
          resetBall();
          updateScore();
        } else if (
          ballBody.position.z > 19 &&
          ballBody.position.x > -1 &&
          ballBody.position.x < 1
        ) {
          score2++;
          resetBall();
          updateScore();
        }
      }

      function resetBall() {
        ballBody.position.set(0, 0.5, 0);
        ballBody.velocity.set(0, 0, 0);
      }

      function updateScore() {
        scoreboard.textContent = `Гравець 1: ${score1} | Гравець 2: ${score2}`;
      }
    </script>
  </body>
</html>
